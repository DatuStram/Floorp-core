{"version":3,"file":"content.js","sources":["../src/components/custom-shortcut-key/index.ts","../src/index-content.ts"],"sourcesContent":["import { commands } from \"./commands\";\nimport { zCSKCommands, zCSKData, type CSKData } from \"./defines\";\nimport { checkIsSystemShortcut } from \"./utils\";\nimport { z } from \"zod\";\n\nexport class CustomShortcutKey {\n  private static instance: CustomShortcutKey;\n  private static windows: Window[] = [];\n\n  //this boolean disable shortcut of csk\n  //useful for registering\n  disable_csk = false;\n  static getInstance() {\n    if (!CustomShortcutKey.instance) {\n      CustomShortcutKey.instance = new CustomShortcutKey();\n    }\n    if (!CustomShortcutKey.windows.includes(window)) {\n      CustomShortcutKey.instance.startHandleShortcut(window);\n      CustomShortcutKey.windows.push(window);\n      console.log(\"add window\");\n    }\n    //@ts-ignore\n    Services.obs.addObserver(CustomShortcutKey.instance, \"nora-csk\");\n    return CustomShortcutKey.instance;\n  }\n\n  //@ts-ignore\n  observe(_subj, topic: \"nora-csk\", data: string) {\n    switch (topic) {\n      case \"nora-csk\":\n        const d = zCSKCommands.safeParse(JSON.parse(data));\n        if (d.success) {\n          switch (d.data.type) {\n            case \"disable-csk\": {\n              this.disable_csk = d.data.data;\n            }\n          }\n        }\n\n        break;\n    }\n  }\n\n  cskData: CSKData = {};\n  private constructor() {\n    this.initCSKData();\n\n    console.warn(\"CSK Init Completed\");\n  }\n\n  private initCSKData() {\n    this.cskData = {\n      \"gecko-open-new-window\": {\n        modifiers: {\n          ctrl: true,\n          shift: true,\n          alt: false,\n          meta: false,\n        },\n        key: \"V\",\n      },\n    };\n  }\n  private startHandleShortcut(_window: Window) {\n    _window.addEventListener(\"keydown\", (ev) => {\n      if (this.disable_csk) {\n        console.log(\"disable-csk\");\n        return;\n      }\n      if (\n        [\"Control\", \"Alt\", \"Meta\", \"Shift\"].filter((k) => ev.key.includes(k))\n          .length === 0\n      ) {\n        if (checkIsSystemShortcut(ev)) {\n          console.warn(`This Event is registered in System: ${ev}`);\n          return;\n        }\n\n        for (const [_key, shortcutDatum] of Object.entries(this.cskData)) {\n          const key = _key as keyof CSKData;\n          const { alt, ctrl, meta, shift } = shortcutDatum!.modifiers;\n          if (\n            ev.altKey === alt &&\n            ev.ctrlKey === ctrl &&\n            ev.metaKey === meta &&\n            ev.shiftKey === shift &&\n            ev.key === shortcutDatum!.key\n          ) {\n            commands[key].command(ev);\n          }\n        }\n      }\n    });\n  }\n}\n","import { CustomShortcutKey } from \"./components/custom-shortcut-key\";\n\nCustomShortcutKey.getInstance();\n"],"names":[],"mappings":";;;;;;;AAKO,MAAM,qBAAN,MAAM,mBAAkB;AAAA,EAuCrB,cAAc;AAjCtB;AAAA;AAAA,uCAAc;AAgCd,mCAAmB,CAAA;AAEjB,SAAK,YAAY;AAEjB,YAAQ,KAAK,oBAAoB;AAAA,EACnC;AAAA,EApCA,OAAO,cAAc;AACf,QAAA,CAAC,mBAAkB,UAAU;AACb,yBAAA,WAAW,IAAI;IACnC;AACA,QAAI,CAAC,mBAAkB,QAAQ,SAAS,MAAM,GAAG;AAC7B,yBAAA,SAAS,oBAAoB,MAAM;AACnC,yBAAA,QAAQ,KAAK,MAAM;AACrC,cAAQ,IAAI,YAAY;AAAA,IAC1B;AAEA,aAAS,IAAI,YAAY,mBAAkB,UAAU,UAAU;AAC/D,WAAO,mBAAkB;AAAA,EAC3B;AAAA;AAAA,EAGA,QAAQ,OAAO,OAAmB,MAAc;AAC9C,YAAQ,OAAO;AAAA,MACb,KAAK;AACH,cAAM,IAAI,aAAa,UAAU,KAAK,MAAM,IAAI,CAAC;AACjD,YAAI,EAAE,SAAS;AACL,kBAAA,EAAE,KAAK,MAAM;AAAA,YACnB,KAAK,eAAe;AACb,mBAAA,cAAc,EAAE,KAAK;AAAA,YAC5B;AAAA,UACF;AAAA,QACF;AAEA;AAAA,IACJ;AAAA,EACF;AAAA,EASQ,cAAc;AACpB,SAAK,UAAU;AAAA,MACb,yBAAyB;AAAA,QACvB,WAAW;AAAA,UACT,MAAM;AAAA,UACN,OAAO;AAAA,UACP,KAAK;AAAA,UACL,MAAM;AAAA,QACR;AAAA,QACA,KAAK;AAAA,MACP;AAAA,IAAA;AAAA,EAEJ;AAAA,EACQ,oBAAoB,SAAiB;AACnC,YAAA,iBAAiB,WAAW,CAAC,OAAO;AAC1C,UAAI,KAAK,aAAa;AACpB,gBAAQ,IAAI,aAAa;AACzB;AAAA,MACF;AACA,UACE,CAAC,WAAW,OAAO,QAAQ,OAAO,EAAE,OAAO,CAAC,MAAM,GAAG,IAAI,SAAS,CAAC,CAAC,EACjE,WAAW,GACd;AACI,YAAA,sBAAsB,EAAE,GAAG;AACrB,kBAAA,KAAK,uCAAuC,EAAE,EAAE;AACxD;AAAA,QACF;AAEW,mBAAA,CAAC,MAAM,aAAa,KAAK,OAAO,QAAQ,KAAK,OAAO,GAAG;AAChE,gBAAM,MAAM;AACZ,gBAAM,EAAE,KAAK,MAAM,MAAM,UAAU,cAAe;AAClD,cACE,GAAG,WAAW,OACd,GAAG,YAAY,QACf,GAAG,YAAY,QACf,GAAG,aAAa,SAChB,GAAG,QAAQ,cAAe,KAC1B;AACS,qBAAA,GAAG,EAAE,QAAQ,EAAE;AAAA,UAC1B;AAAA,QACF;AAAA,MACF;AAAA,IAAA,CACD;AAAA,EACH;AACF;AAxFE,cADW,oBACI;AACf,cAFW,oBAEI,WAAoB,CAAA;AAF9B,IAAM,oBAAN;ACHP,kBAAkB,YAAY;"}